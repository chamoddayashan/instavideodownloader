<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>InstaSaver - Free Instagram Video Downloader</title>
    <meta name="description" content="Download Instagram videos quickly. Free online tool, high quality 1080p MP4.">
    <meta name="robots" content="index, follow">
    
    <meta name="referrer" content="no-referrer"> 
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #d62976;
            --accent: #fa7e1e;
            --bg-dark: #0f0f11;
            --card-bg: rgba(255, 255, 255, 0.05);
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 20%, rgba(214, 41, 118, 0.15) 0%, transparent 40%),
                              radial-gradient(circle at 90% 80%, rgba(250, 126, 30, 0.15) 0%, transparent 40%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
        }

        header { padding: 20px 0; display: flex; justify-content: space-between; align-items: center; }

        .logo {
            font-weight: 700; font-size: 1.5rem;
            background: linear-gradient(45deg, var(--accent), var(--primary));
         
            text-decoration: none;
        }

        /* --- HERO & INPUT --- */
        .hero { text-align: center; padding: 60px 0 20px; animation: fadeInDown 0.8s ease; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 15px; line-height: 1.2; }
        .hero p { color: var(--text-muted); margin-bottom: 30px; }

        .search-box {
            background: var(--card-bg); backdrop-filter: blur(12px);
            border: var(--glass-border); padding: 10px; border-radius: 50px;
            display: flex; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .search-box input {
            flex: 1; background: transparent; border: none;
            padding: 15px 20px; color: white; font-size: 1rem; outline: none;
        }

        .search-box button {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none; padding: 12px 30px; border-radius: 40px;
            color: white; font-weight: 600; cursor: pointer;
            transition: filter 0.3s ease;
        }

        .search-box button:hover { filter: brightness(1.2); }
        .search-box button:disabled { opacity: 0.7; cursor: not-allowed; }

        /* --- PROGRESS BAR --- */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-top: 25px;
            overflow: hidden;
            display: none; /* Hidden initially */
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 10px;
            transition: width 0.4s ease;
        }

        /* --- RESULT CARD --- */
        #result-area { display: none; margin-top: 30px; animation: slideUp 0.5s ease; }

        .video-card {
            background: var(--card-bg); border: var(--glass-border);
            border-radius: var(--radius); padding: 20px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }

        .thumbnail-wrapper {
            width: 100%; max-width: 300px; border-radius: 12px;
            overflow: hidden; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            background: #000;
        }

        .thumbnail-wrapper img { width: 100%; display: block; }

        .download-btn {
            background: white; color: black; padding: 12px 24px;
            border-radius: 8px; text-decoration: none; font-weight: 600;
            display: inline-block; transition: transform 0.2s;
        }
        .download-btn:hover { transform: scale(1.05); }

        /* --- FOOTER & ADS --- */
        .ad-container {
            width: 100%; min-height: 100px; background: rgba(255,255,255,0.02);
            border: 1px dashed rgba(255,255,255,0.1); margin: 40px 0;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-muted); font-size: 0.8rem; border-radius: var(--radius);
        }

        footer {
            margin-top: auto; padding: 40px 0; text-align: center;
            border-top: var(--glass-border); color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MOBILE --- */
        @media (max-width: 600px) {
            .hero h1 { font-size: 1.8rem; }
            .search-box { flex-direction: column; padding: 15px; border-radius: 20px; }
            .search-box button { width: 100%; justify-content: center; margin-top: 10px; }
        }
    </style>
</head>
<body>

    <header class="container">
        <a href="#" class="logo">InstaSaver.</a>
    </header>

    <main class="container">
        
        <section class="hero">
            <h1>Download Instagram Videos<br>Fast & Free</h1>
            <p>Paste the link from a public account below to start.</p>
            
            <div class="search-box">
                <input type="text" id="urlInput" placeholder="Paste URL (e.g., https://www.instagram.com/reel/...)">
                <button id="downloadBtn">Download</button>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <p id="error-msg" style="color: #ff4b4b; margin-top: 15px; font-size: 0.9rem; display: none;"></p>
        </section>

        <div class="ad-container">
            <span>Ad Space (Display Ad)</span>
        </div>

        <div id="result-area">
            <div class="video-card">
               <img src="" id="videoThumb" alt="Instagram Video Thumbnail">
                <h3 id="videoTitle" style="margin-bottom: 10px;">Instagram Video</h3>
                <a href="#" class="download-btn" id="downloadLink" target="_blank">Download .MP4</a>
            </div>
        </div>

        <div class="ad-container">
            <span>Ad Space (Footer Ad)</span>
        </div>

    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 InstaSaver. All rights reserved.</p>
        </div>
    </footer>

   <script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Get Elements
        const btn = document.getElementById('downloadBtn');
        const input = document.getElementById('urlInput');
        const resultArea = document.getElementById('result-area');
        const errorMsg = document.getElementById('error-msg');
        
        // Progress Bar Elements
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');

        // Result Elements
        const videoThumb = document.getElementById('videoThumb');
        const videoTitle = document.getElementById('videoTitle');
        const downloadLink = document.getElementById('downloadLink');

        // --- DEBUGGING CHECK ---
        // This will tell you if your HTML is missing something
        if (!videoThumb) console.error("CRITICAL ERROR: Could not find <img id='videoThumb'> in HTML");
        if (!resultArea) console.error("CRITICAL ERROR: Could not find <div id='result-area'> in HTML");
        // -----------------------

        let progressInterval = null;

        if (btn) {
            btn.addEventListener('click', async () => {
                const url = input.value.trim();

                resetUI();

                if (!url || !url.includes('instagram.com')) {
                    showError("Please paste a valid Instagram link.");
                    return;
                }

                startProgress();

                try {
                    // USE YOUR RAILWAY URL HERE
                    const response = await fetch('https://YOUR-RAILWAY-APP-URL.up.railway.app/api/download', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    });

                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.message || "Failed to download");
                    }

                    finishProgress();

                    setTimeout(() => {
                        // Check if elements exist before using them to prevent crash
                        if (videoThumb) videoThumb.src = data.thumbnail || "https://via.placeholder.com/600x600?text=No+Preview";
                        if (videoTitle) videoTitle.innerText = data.title || "Instagram Video"; 
                        if (downloadLink) downloadLink.href = data.downloadUrl;
                        
                        if (resultArea) {
                            resultArea.style.display = 'block';
                            resultArea.scrollIntoView({ behavior: 'smooth' });
                        }
                    }, 500);

                } catch (err) {
                    console.error(err);
                    stopProgress();
                    showError(err.message || "Failed to fetch video.");
                }
            });
        }

        // --- HELPER FUNCTIONS ---

        function startProgress() {
            if (btn) {
                btn.disabled = true;
                btn.innerText = "Processing...";
            }
            if (progressContainer) {
                progressContainer.style.display = 'block';
                if (progressBar) progressBar.style.width = '0%';
            }
            
            let width = 0;
            progressInterval = setInterval(() => {
                if (width >= 90) {
                    clearInterval(progressInterval);
                } else {
                    width += Math.random() * 10;
                    if (progressBar) progressBar.style.width = width + '%';
                }
            }, 300);
        }

        function finishProgress() {
            clearInterval(progressInterval);
            if (progressBar) progressBar.style.width = '100%';
            if (btn) btn.innerText = "Downloaded!";
            setTimeout(() => {
                 if (btn) {
                    btn.disabled = false;
                    btn.innerText = "Download";
                 }
                 if (progressContainer) progressContainer.style.display = 'none';
            }, 1000);
        }

        function stopProgress() {
            clearInterval(progressInterval);
            if (progressContainer) progressContainer.style.display = 'none';
            if (btn) {
                btn.disabled = false;
                btn.innerText = "Download";
            }
        }

        function resetUI() {
            if (errorMsg) errorMsg.style.display = 'none';
            if (resultArea) resultArea.style.display = 'none';
            
            // THIS IS WHERE YOUR ERROR WAS
            // We add a check "if (videoThumb)" so it skips it if missing, instead of crashing.
            if (videoThumb) videoThumb.src = ""; 
        }

        function showError(msg) {
            if (errorMsg) {
                errorMsg.innerText = msg;
                errorMsg.style.display = 'block';
            }
            if (input) {
                input.style.border = "1px solid #ff4b4b";
                setTimeout(() => input.style.border = "none", 500);
            }
        }
    });
</script>
</body>
</html>